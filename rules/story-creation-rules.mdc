---
alwaysApply: true
---

# Regras para Cria√ß√£o de Hist√≥rias (Stories)

Este documento define o padr√£o completo para cria√ß√£o de hist√≥rias t√©cnicas de infraestrutura no reposit√≥rio.

## üìÅ Estrutura de Pastas

### Nomenclatura da Pasta da Hist√≥ria

**Formato obrigat√≥rio:**
```
Storie-XX-Descricao_Breve_Da_Historia
```

**Regras:**
- Sempre come√ßar com `Storie-` seguido do n√∫mero com 2 d√≠gitos (01, 02, 03...)
- N√∫mero deve ser sequencial e √∫nico
- Descri√ß√£o deve ser curta (m√°ximo 5-6 palavras)
- Usar underscore (`_`) para separar palavras na descri√ß√£o
- Descri√ß√£o deve ser clara e permitir identificar o conte√∫do apenas pelo nome da pasta
- Primeira letra de cada palavra em mai√∫scula (PascalCase para palavras, snake_case para separa√ß√£o)

**Exemplos corretos:**
- `Storie-01-Backend_Terraform_S3`
- `Storie-05-Modulo_Cluster_EKS`
- `Storie-12-Security_Groups_EKS`
- `Storie-15-Padronizacao_Variaveis_Ambientes`

**Exemplos incorretos:**
- `Storie-1-Backend` (n√∫mero sem zero √† esquerda)
- `Storie-01-backend-terraform` (usar h√≠fen em vez de underscore)
- `Storie-01-BackendTerraformS3` (sem separa√ß√£o, dif√≠cil de ler)

### Estrutura Interna da Pasta

```
Storie-XX-Descricao/
‚îú‚îÄ‚îÄ story.md                    # Arquivo principal da hist√≥ria
‚îî‚îÄ‚îÄ subtask/                    # Pasta contendo todas as subtasks
    ‚îú‚îÄ‚îÄ Subtask-01-Nome.md
    ‚îú‚îÄ‚îÄ Subtask-02-Nome.md
    ‚îî‚îÄ‚îÄ Subtask-03-Nome.md
```

**Regras:**
- Sempre ter um arquivo `story.md` na raiz da pasta
- Sempre ter uma pasta `subtask/` (mesmo que vazia inicialmente)
- Nenhum outro arquivo na raiz da pasta da hist√≥ria

## üìù Formato do Arquivo story.md

### Estrutura Obrigat√≥ria

```markdown
# Storie-XX: T√≠tulo da Hist√≥ria

## Status
- **Estado:** üîÑ Em desenvolvimento | ‚úÖ Conclu√≠da | ‚è∏Ô∏è Pausada
- **Data de Conclus√£o:** [DD/MM/AAAA] (preencher quando conclu√≠da)

## Descri√ß√£o
Como [papel], quero [a√ß√£o], para [benef√≠cio].

## Objetivo
[Descri√ß√£o clara e objetiva do que ser√° entregue]

## Escopo T√©cnico
- Tecnologias: [Lista de tecnologias]
- Arquivos afetados: [Lista de arquivos/caminhos]
- Recursos AWS: [Lista de recursos AWS que ser√£o criados]

## Subtasks

- [ ] [Subtask 01: Nome da subtask](./subtask/Subtask-01-Nome_da_subtask.md) - *Data de Conclus√£o: [DD/MM/AAAA]*
- [ ] [Subtask 02: Nome da subtask](./subtask/Subtask-02-Nome_da_subtask.md) - *Data de Conclus√£o: [DD/MM/AAAA]*
- [ ] [Subtask 03: Nome da subtask](./subtask/Subtask-03-Nome_da_subtask.md) - *Data de Conclus√£o: [DD/MM/AAAA]*

## Crit√©rios de Aceite da Hist√≥ria

- [ ] Crit√©rio 1 (espec√≠fico e mensur√°vel)
- [ ] Crit√©rio 2 (espec√≠fico e mensur√°vel)
- [ ] Crit√©rio 3 (espec√≠fico e mensur√°vel)
```

### Regras de Escrita do story.md

1. **Status:**
   - Campo obrigat√≥rio que indica o estado atual da hist√≥ria
   - Estados poss√≠veis: üîÑ Em desenvolvimento | ‚úÖ Conclu√≠da | ‚è∏Ô∏è Pausada
   - Quando uma hist√≥ria for conclu√≠da, deve-se:
     - Alterar o estado para "‚úÖ Conclu√≠da"
     - Preencher a data de conclus√£o no formato DD/MM/AAAA
   - Este campo deve ser atualizado sempre que o status da hist√≥ria mudar

2. **T√≠tulo:**
   - Formato: `# Storie-XX: T√≠tulo da Hist√≥ria`
   - T√≠tulo deve ser claro e descritivo
   - M√°ximo 10 palavras

3. **Descri√ß√£o:**
   - Usar formato "Como... quero... para..."
   - Ser espec√≠fico sobre o papel (ex: "engenheiro de plataforma")
   - A√ß√£o deve ser clara e objetiva
   - Benef√≠cio deve ser mensur√°vel ou observ√°vel

4. **Objetivo:**
   - Uma √∫nica frase ou par√°grafo curto
   - Deve explicar O QUE ser√° entregue, n√£o COMO
   - Focar no resultado final

5. **Escopo T√©cnico:**
   - Listar tecnologias espec√≠ficas (ex: "Terraform, AWS EKS")
   - Listar arquivos/caminhos que ser√£o criados/modificados
   - Listar recursos AWS que ser√£o provisionados
   - Ser espec√≠fico, n√£o gen√©rico

6. **Subtasks:**
   - M√≠nimo 3 subtasks, m√°ximo 8 subtasks
   - Cada subtask deve ser uma a√ß√£o espec√≠fica e test√°vel
   - Ordem deve fazer sentido l√≥gico (depend√™ncias)
   - Links devem usar caminho relativo: `./subtask/Subtask-XX-Nome.md`
   - **Marca√ß√£o de Conclus√£o (OBRIGAT√ìRIO)**:
     - Usar checkbox `- [ ]` para subtasks n√£o conclu√≠das
     - Usar checkbox `- [x]` para subtasks conclu√≠das
     - **Sempre preencher a data de conclus√£o** quando marcar como conclu√≠da
     - Formato: `- [x] [Subtask XX: Nome](./subtask/Subtask-XX-Nome.md) - *Data de Conclus√£o: DD/MM/AAAA*`
   - **Atualiza√ß√£o Cont√≠nua**: As subtasks devem ser marcadas como conclu√≠das √† medida que s√£o desenvolvidas, n√£o apenas no final da hist√≥ria

7. **Crit√©rios de Aceite:**
   - M√≠nimo 5 crit√©rios, ideal 7-10
   - Cada crit√©rio deve ser:
     - Espec√≠fico (n√£o gen√©rico)
     - Mensur√°vel (pode ser validado)
     - Test√°vel (pode ser verificado)
   - Usar formato de checklist: `- [ ]`
   - Incluir crit√©rios de:
     - Funcionalidade (o que foi criado)
     - Qualidade (valida√ß√µes, testes)
     - Documenta√ß√£o (se aplic√°vel)

## üìã Formato do Arquivo de Subtask

### Nomenclatura da Subtask

**Formato obrigat√≥rio:**
```
Subtask-XX-Nome_Da_Subtask.md
```

**Regras:**
- Sempre come√ßar com `Subtask-` seguido do n√∫mero com 2 d√≠gitos (01, 02, 03...)
- N√∫mero deve ser sequencial dentro da hist√≥ria
- Nome deve ser curto e descritivo (m√°ximo 4-5 palavras)
- Usar underscore (`_`) para separar palavras
- Primeira letra de cada palavra em mai√∫scula

**Exemplos corretos:**
- `Subtask-01-Criar_modulo_Terraform_backend_S3.md`
- `Subtask-02-Configurar_backend_tf_principal.md`
- `Subtask-03-Adicionar_IAM_policies_minimas_backend.md`

### Estrutura Obrigat√≥ria da Subtask

```markdown
# Subtask XX: Nome da Subtask

## Status
- **Estado:** üîÑ Em desenvolvimento | ‚úÖ Conclu√≠da
- **Data de Conclus√£o:** [DD/MM/AAAA] (preencher quando conclu√≠da)

## Descri√ß√£o
[Uma ou duas frases explicando exatamente o que ser√° feito nesta subtask]

## Passos de implementa√ß√£o
- [ ] [Passo 1 espec√≠fico e acion√°vel]
- [ ] [Passo 2 espec√≠fico e acion√°vel]
- [ ] [Passo 3 espec√≠fico e acion√°vel]

## Como testar
- [Teste 1: Como validar este passo]
- [Teste 2: Comando ou a√ß√£o de valida√ß√£o]
- [Teste 3: Verifica√ß√£o manual ou automatizada]

## Crit√©rios de aceite
- [ ] [Crit√©rio 1 espec√≠fico e mensur√°vel]
- [ ] [Crit√©rio 2 espec√≠fico e mensur√°vel]
- [ ] [Crit√©rio 3 espec√≠fico e mensur√°vel]
```

### Regras de Escrita da Subtask

1. **Status:**
   - Campo obrigat√≥rio que indica o estado atual da subtask
   - Estados poss√≠veis: üîÑ Em desenvolvimento | ‚úÖ Conclu√≠da
   - Quando uma subtask for conclu√≠da, deve-se:
     - Alterar o estado para "‚úÖ Conclu√≠da"
     - Preencher a data de conclus√£o no formato DD/MM/AAAA
   - Este campo deve ser atualizado assim que a subtask for finalizada
   - **IMPORTANTE**: A subtask tamb√©m deve ser marcada como conclu√≠da na lista de subtasks do `story.md`

2. **Descri√ß√£o:**
   - M√°ximo 2-3 frases
   - Deve ser clara sobre O QUE ser√° feito
   - N√£o precisa explicar COMO (isso vai nos passos)

3. **Passos de implementa√ß√£o:**
   - M√≠nimo 3 passos, ideal 5-8 passos
   - Cada passo deve ser:
     - Espec√≠fico (n√£o gen√©rico)
     - Acion√°vel (pode ser executado)
     - Sequencial (ordem l√≥gica)
   - Usar formato de checklist: `- [ ]` para passos n√£o conclu√≠dos, `- [x]` para passos conclu√≠dos
   - Marcar passos como conclu√≠dos √† medida que s√£o implementados
   - Incluir nomes de arquivos, recursos, ou comandos quando relevante
   - Exemplo: `- [x] Criar arquivo terraform/modules/eks/main.tf`

3. **Como testar:**
   - M√≠nimo 3 formas de teste/valida√ß√£o
   - Deve incluir:
     - Comandos para executar (ex: `terraform validate`)
     - Verifica√ß√µes manuais (ex: "Verificar via AWS CLI")
     - Valida√ß√µes automatizadas (ex: "Teste unit√°rio deve passar")
   - Cada teste deve ser execut√°vel e verific√°vel
   - **IMPORTANTE:** Subtasks devem ser simples o suficiente para serem testadas individualmente

4. **Crit√©rios de aceite:**
   - M√≠nimo 3 crit√©rios, ideal 4-6 crit√©rios
   - Cada crit√©rio deve ser:
     - Espec√≠fico (ex: "Arquivo main.tf criado" n√£o "C√≥digo criado")
     - Mensur√°vel (pode ser verificado)
     - Test√°vel (pode ser validado)
   - Usar formato de checklist: `- [ ]` para crit√©rios n√£o atendidos, `- [x]` para crit√©rios atendidos
   - Marcar crit√©rios como atendidos √† medida que s√£o validados

## ‚úÖ Princ√≠pios de Qualidade

### Simplicidade das Subtasks

**Regra fundamental:** Cada subtask deve ser simples o suficiente para:
1. Ser implementada em 1-2 horas (ideal)
2. Ser testada de forma independente
3. Ter crit√©rios de aceite claros e objetivos
4. Poder ser validada sem depender de outras subtasks (quando poss√≠vel)

**Se uma subtask for muito complexa:**
- Quebre em m√∫ltiplas subtasks menores
- Cada subtask deve ter um objetivo √∫nico e claro
- Evite subtasks que fazem "muitas coisas ao mesmo tempo"

### Consist√™ncia

1. **Nomenclatura:**
   - Sempre seguir o padr√£o estabelecido
   - Manter consist√™ncia entre hist√≥rias
   - Usar termos t√©cnicos corretos

2. **Formato:**
   - Sempre usar a estrutura obrigat√≥ria
   - Manter formata√ß√£o consistente
   - Usar markdown corretamente

3. **Linguagem:**
   - Usar portugu√™s brasileiro
   - Ser claro e objetivo
   - Evitar jarg√µes desnecess√°rios
   - Usar termos t√©cnicos quando apropriado

### Rastreabilidade

1. **Links:**
   - Todos os links devem ser relativos
   - Links devem funcionar quando acessados
   - Formato: `./subtask/Subtask-XX-Nome.md`

2. **Refer√™ncias:**
   - Se referenciar outras hist√≥rias, usar caminho relativo
   - Se referenciar arquivos do projeto, usar caminho relativo
   - Exemplo: `terraform/modules/backend/main.tf`

## üìä Checklist de Cria√ß√£o de Hist√≥ria

Antes de considerar uma hist√≥ria completa, verificar:

### Estrutura
- [ ] Pasta criada com nome no formato `Storie-XX-Descricao_Breve`
- [ ] Arquivo `story.md` criado na raiz da pasta
- [ ] Pasta `subtask/` criada
- [ ] Todas as subtasks criadas na pasta `subtask/`

### Conte√∫do do story.md
- [ ] Status preenchido (Estado e Data de Conclus√£o quando aplic√°vel)
- [ ] T√≠tulo no formato correto
- [ ] Descri√ß√£o no formato "Como... quero... para..."
- [ ] Objetivo claro e objetivo
- [ ] Escopo t√©cnico completo (tecnologias, arquivos, recursos)
- [ ] M√≠nimo 3 subtasks listadas
- [ ] Subtasks com checkboxes para marca√ß√£o de conclus√£o
- [ ] Datas de conclus√£o preenchidas para subtasks conclu√≠das
- [ ] Links das subtasks funcionando
- [ ] M√≠nimo 5 crit√©rios de aceite
- [ ] Todos os crit√©rios s√£o espec√≠ficos e mensur√°veis

### Conte√∫do das Subtasks
- [ ] Cada subtask tem Status preenchido (Estado e Data de Conclus√£o quando aplic√°vel)
- [ ] Cada subtask tem descri√ß√£o clara
- [ ] Cada subtask tem m√≠nimo 3 passos de implementa√ß√£o
- [ ] Passos de implementa√ß√£o usam checkboxes para rastreamento
- [ ] Cada subtask tem m√≠nimo 3 formas de teste
- [ ] Cada subtask tem m√≠nimo 3 crit√©rios de aceite
- [ ] Crit√©rios de aceite usam checkboxes para valida√ß√£o
- [ ] Subtasks s√£o simples e test√°veis individualmente
- [ ] Ordem das subtasks faz sentido l√≥gico
- [ ] Subtasks conclu√≠das est√£o marcadas no story.md e na pr√≥pria subtask

### Qualidade
- [ ] Nomenclatura consistente
- [ ] Formata√ß√£o markdown correta
- [ ] Sem erros de ortografia
- [ ] Linguagem clara e objetiva
- [ ] Termos t√©cnicos usados corretamente

## üéØ Exemplo Completo

### Estrutura de Pasta
```
stories/
‚îî‚îÄ‚îÄ Storie-19-Criar_Manifests_Kubernetes/
    ‚îú‚îÄ‚îÄ story.md
    ‚îî‚îÄ‚îÄ subtask/
        ‚îú‚îÄ‚îÄ Subtask-01-Criar_namespace_orderhub.md
        ‚îú‚îÄ‚îÄ Subtask-02-Criar_deployment_orderhub.md
        ‚îú‚îÄ‚îÄ Subtask-03-Criar_service_orderhub.md
        ‚îî‚îÄ‚îÄ Subtask-04-Criar_hpa_orderhub.md
```

### Exemplo de story.md
```markdown
# Storie-19: Criar Manifests Kubernetes para OrderHub

## Status
- **Estado:** ‚úÖ Conclu√≠da
- **Data de Conclus√£o:** 15/12/2024

## Descri√ß√£o
Como engenheiro de plataforma, quero criar manifests Kubernetes (Deployment, Service, HPA) para o microsservi√ßo OrderHub, para que ele possa ser implantado no cluster EKS com escalabilidade horizontal independente.

## Objetivo
Criar manifests Kubernetes completos para o OrderHub incluindo Deployment, Service tipo LoadBalancer, e HPA configurado para escalar baseado em CPU, garantindo alta disponibilidade e escalabilidade autom√°tica.

## Escopo T√©cnico
- Tecnologias: Kubernetes, YAML, EKS
- Arquivos afetados: `k8s/app/orderhub/deployment.yaml`, `k8s/app/orderhub/service.yaml`, `k8s/app/orderhub/hpa.yaml`
- Recursos Kubernetes: Deployment, Service (LoadBalancer), HorizontalPodAutoscaler

## Subtasks

- [x] [Subtask 01: Criar namespace orderhub](./subtask/Subtask-01-Criar_namespace_orderhub.md) - *Data de Conclus√£o: 10/12/2024*
- [x] [Subtask 02: Criar deployment para OrderHub](./subtask/Subtask-02-Criar_deployment_orderhub.md) - *Data de Conclus√£o: 11/12/2024*
- [x] [Subtask 03: Criar service LoadBalancer para OrderHub](./subtask/Subtask-03-Criar_service_orderhub.md) - *Data de Conclus√£o: 12/12/2024*
- [ ] [Subtask 04: Criar HPA para OrderHub](./subtask/Subtask-04-Criar_hpa_orderhub.md) - *Data de Conclus√£o: [DD/MM/AAAA]*

## Crit√©rios de Aceite da Hist√≥ria

- [ ] Namespace `orderhub` criado em `k8s/app/orderhub/namespace.yaml`
- [ ] Deployment criado com imagem do ECR `orderhub-api`
- [ ] Deployment configurado com resources (requests e limits)
- [ ] Service tipo LoadBalancer criado com annotations para NLB
- [ ] HPA criado com minReplicas=2, maxReplicas=5
- [ ] HPA configurado para escalar baseado em CPU (targetCPUUtilization=70)
- [ ] Manifests validados com `kubectl apply --dry-run=client`
- [ ] Documenta√ß√£o de deploy criada
```

### Exemplo de Subtask
```markdown
# Subtask 01: Criar namespace orderhub

## Status
- **Estado:** ‚úÖ Conclu√≠da
- **Data de Conclus√£o:** 10/12/2024

## Descri√ß√£o
Criar arquivo YAML para namespace Kubernetes que ser√° usado pelo microsservi√ßo OrderHub, garantindo isolamento de recursos.

## Passos de implementa√ß√£o
- [x] Criar diret√≥rio `k8s/app/orderhub/`
- [x] Criar arquivo `namespace.yaml` no diret√≥rio
- [x] Adicionar recurso `kind: Namespace` com `name: orderhub`
- [x] Adicionar labels padr√£o: `app: orderhub`, `env: dev`
- [x] Adicionar coment√°rios explicativos no arquivo

## Como testar
- Executar `kubectl apply --dry-run=client -f k8s/app/orderhub/namespace.yaml` (deve passar sem erros)
- Validar sintaxe YAML com validador online ou `yamllint`
- Verificar que o arquivo segue padr√£o de indenta√ß√£o (2 espa√ßos)
- Executar `kubectl get namespace orderhub` ap√≥s aplicar (deve retornar o namespace)

## Crit√©rios de aceite
- [x] Arquivo `k8s/app/orderhub/namespace.yaml` criado
- [x] Namespace tem nome `orderhub`
- [x] Labels padr√£o aplicadas (app, env)
- [x] `kubectl apply --dry-run=client` passa sem erros
- [x] Sintaxe YAML v√°lida
```

## üìà Rastreamento de Progresso

### Atualiza√ß√£o de Subtasks Durante Desenvolvimento

**Regra fundamental**: As subtasks devem ser atualizadas **durante o desenvolvimento**, n√£o apenas no final.

#### Quando Marcar uma Subtask como Conclu√≠da

1. **Ao finalizar a implementa√ß√£o**:
   - Todos os passos de implementa√ß√£o foram executados
   - Todos os testes foram executados e passaram
   - Todos os crit√©rios de aceite foram validados

2. **Atualiza√ß√µes necess√°rias**:
   - Marcar checkbox da subtask no `story.md`: `- [x]`
   - Adicionar data de conclus√£o no `story.md`: `- *Data de Conclus√£o: DD/MM/AAAA*`
   - Atualizar Status na pr√≥pria subtask:
     ```markdown
     ## Status
     - **Estado:** ‚úÖ Conclu√≠da
     - **Data de Conclus√£o:** DD/MM/AAAA
     ```
   - Marcar passos de implementa√ß√£o como conclu√≠dos: `- [x]`
   - Marcar crit√©rios de aceite como atendidos: `- [x]`

#### Exemplo de Fluxo de Trabalho

1. **In√≠cio da Subtask**:
   ```markdown
   ## Status
   - **Estado:** üîÑ Em desenvolvimento
   - **Data de Conclus√£o:** [DD/MM/AAAA]
   ```

2. **Durante o desenvolvimento**:
   - Marcar passos como conclu√≠dos √† medida que s√£o implementados
   - Marcar crit√©rios como atendidos √† medida que s√£o validados

3. **Conclus√£o da Subtask**:
   ```markdown
   ## Status
   - **Estado:** ‚úÖ Conclu√≠da
   - **Data de Conclus√£o:** 15/12/2024
   ```
   - E atualizar no `story.md`:
   ```markdown
   - [x] [Subtask 01: Nome](./subtask/Subtask-01-Nome.md) - *Data de Conclus√£o: 15/12/2024*
   ```

### Atualiza√ß√£o da Story

A story deve ser marcada como conclu√≠da apenas quando:
- Todas as subtasks foram conclu√≠das
- Todos os crit√©rios de aceite da hist√≥ria foram atendidos
- A data de conclus√£o deve ser a data da √∫ltima subtask conclu√≠da ou a data de valida√ß√£o final

---

## üö´ Erros Comuns a Evitar

1. **Subtasks muito complexas:**
   - ‚ùå "Criar m√≥dulo EKS completo com todas as configura√ß√µes"
   - ‚úÖ "Criar estrutura base do m√≥dulo EKS" + "Implementar recurso aws_eks_cluster" + "Configurar logging"

2. **Crit√©rios de aceite vagos:**
   - ‚ùå "C√≥digo funciona"
   - ‚úÖ "terraform validate passa sem erros"

3. **Falta de testabilidade:**
   - ‚ùå "Verificar que est√° correto"
   - ‚úÖ "Executar terraform plan e verificar que mostra cria√ß√£o de 1 recurso"

4. **Nomenclatura inconsistente:**
   - ‚ùå `Storie-1-Backend` (sem zero, sem descri√ß√£o)
   - ‚úÖ `Storie-01-Backend_Terraform_S3`

5. **Links quebrados:**
   - ‚ùå `./Subtask-01.md` (caminho errado)
   - ‚úÖ `./subtask/Subtask-01-Criar_modulo.md`

## üìö Refer√™ncias

- Hist√≥rias existentes em `stories/` servem como exemplos
- Manter consist√™ncia com padr√µes j√° estabelecidos
- Quando em d√∫vida, seguir os exemplos das hist√≥rias 01-18
